<div id='preview-contents' class='note-content'>
                        
                    



<h3 id="æ·±å…¥nodeæµstream">æ·±å…¥ï¼šNODEï¼šæµStream</h3>

<p></p>



<h4 id="ä¸€åˆ†ç±»">ä¸€ã€åˆ†ç±»</h4>

<blockquote>
  <p><code>å¯è¯»æµï¼ˆrequestï¼‰</code>ã€<code>å¯å†™æµï¼ˆresponseï¼‰</code>ã€<code>åŒå·¥æµ</code>ã€<code>è½¬åŒ–æµï¼ˆå‹ç¼©ï¼‰</code></p>
</blockquote>



<h4 id="äºŒä¼˜ç‚¹">äºŒã€ä¼˜ç‚¹ï¼š</h4>

<p>å¯ä»¥åˆ†æ®µè¯»å†™ã€æ§åˆ¶é€Ÿç‡</p>



<h4 id="ä¸‰å¯è¯»æµ">ä¸‰ã€å¯è¯»æµ</h4>

<ol><li rel="1"><p><code>new Stream</code>è¿”å›çš„æ˜¯å¯è¯»æµçš„å®ä¾‹</p></li>
<li rel="2"><p><code>fs.createReadStream</code>è¯»æµ <br>
è¯»æµçš„äº‹ä»¶ï¼š</p>

<ul>
<li><p><code>on('data')</code>  è§¦å‘è¯»å–æµ</p></li>
<li><p><code>on('end')</code> è¯»å–å®Œæ¯•</p></li>
<li><p><code>on('error')</code>å‡ºé”™</p></li>
<li><p><code>pause()</code>ï¼šæš‚åœï¼ˆè¯»å†™æ—¶ï¼Œè¯»å¿«ï¼Œå†™æ…¢ï¼Œä¼šè®©è¯»æš‚åœï¼‰</p></li>
<li><p><code>resume()</code>ï¼šæ¢å¤dataäº‹ä»¶è§¦å‘</p></li></ul></li>
<li rel="3"><p>æ€ä¹ˆæ‰èƒ½æŠŠæœ€ç»ˆå†…å®¹æ‰“å°å‡ºæ¥ï¼Ÿ</p>

<ul>
<li><p>å› ä¸ºè¯»æµæ˜¯åˆ†æ®µè¯»å–ï¼Œæ‰€ä»¥åœ¨on(â€˜dataâ€™)è§¦å‘è¯»å–æµï¼Œåªèƒ½è¯»åˆ°æ¯ä¸€æ®µçš„æµ</p></li>
<li><p>åœ¨<code>end</code>äº‹ä»¶è¯»å–å®Œåï¼ŒæŠŠåœ¨on(â€˜dataâ€™)è¯»å–åˆ°çš„æ‹¼æ¥</p></li>
<li><p>âš ï¸æ³¨æ„ï¼šè¿™é‡Œä¸èƒ½ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼ŒğŸ‰‘ï¸è‡ªè¡Œå®éªŒ</p></li>
<li><p>âœ…æ­£ç¡®ï¼šå£°æ˜ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨è§¦å‘æµçš„æ—¶å€™ï¼Œpushè¿›å»ï¼Œåœ¨è¯»å–å®Œåï¼Œ<code>Buffer.concat(arr).toString()</code></p></li></ul></li>
</ol>



<pre class="prettyprint hljs-dark"><code class="language-javascript hljs"><div class="hljs-line"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>); <span class="hljs-comment">// æ–‡ä»¶ä¸­ä¸ºäº†èƒ½å®ç°æ–‡ä»¶çš„æ“ä½œ ä¹Ÿæä¾›äº†æµç›¸å…³çš„api</span>
</div><div class="hljs-line"><span class="hljs-keyword">let</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
</div><div class="hljs-line"><span class="hljs-comment">// new ReadStream è¿”å›çš„æ˜¯å¯è¯»æµçš„å®ä¾‹</span>
</div><div class="hljs-line"><span class="hljs-keyword">let</span> rs = fs.createReadStream(path.resolve(__dirname,<span class="hljs-string">'name2.txt'</span>),{
</div><div class="hljs-line">    <span class="hljs-attr">flags</span>:<span class="hljs-string">'r'</span>, <span class="hljs-comment">// r w </span>
</div><div class="hljs-line">    highWaterMark:<span class="hljs-number">4</span>, <span class="hljs-comment">// 64k</span>
</div><div class="hljs-line">    encoding:<span class="hljs-literal">null</span>,
</div><div class="hljs-line">    <span class="hljs-attr">autoClose</span>:<span class="hljs-literal">true</span>, <span class="hljs-comment">// è¯»å–å®Œæ¯•å å…³é—­æ–‡ä»¶å—</span>
</div><div class="hljs-line">    start:<span class="hljs-number">0</span>,
</div><div class="hljs-line">    <span class="hljs-attr">end</span>:<span class="hljs-number">5</span> <span class="hljs-comment">// slice(start,end) åŒ…å«endçš„</span>
</div><div class="hljs-line">});
</div><div class="hljs-line"><span class="hljs-keyword">let</span> arr = []; <span class="hljs-comment">// å¼‚æ­¥è§¦å‘çš„</span>
</div><div class="hljs-line">rs.on(<span class="hljs-string">'error'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>{
</div><div class="hljs-line">    <span class="hljs-built_in">console</span>.log(err);
</div><div class="hljs-line">})
</div><div class="hljs-line">rs.on(<span class="hljs-string">'data'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chunk</span>)</span>{
</div><div class="hljs-line">    arr.push(chunk);
</div><div class="hljs-line">    <span class="hljs-built_in">console</span>.log(chunk);
</div><div class="hljs-line">    rs.pause(); <span class="hljs-comment">// æš‚åœdataäº‹ä»¶çš„è§¦å‘</span>
</div><div class="hljs-line">});
</div><div class="hljs-line">rs.on(<span class="hljs-string">'end'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
</div><div class="hljs-line">    <span class="hljs-built_in">console</span>.log(Buffer.concat(arr).toString()); <span class="hljs-comment">// è¯»å–å®Œæ¯•</span>
</div><div class="hljs-line">}); 
</div><div class="hljs-line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
</div><div class="hljs-line">    rs.resume(); <span class="hljs-comment">// æ¢å¤dataäº‹ä»¶è§¦å‘</span>
</div><div class="hljs-line">},<span class="hljs-number">1000</span>);
</div></code></pre>



<h4 id="å››å¯å†™æµ">å››ã€å¯å†™æµ</h4>

<ol><li rel="1"><p>æ–¹æ³•ï¼š <br>
<code>write</code>ï¼šè¡¨ç¤ºä½ å†™å…¥çš„å†…å®¹ å·²ç»å¤§äº é¢„è®¡çš„æ°´ä½çº¿ highwatermark <br>
<code>end()</code> <br>
âš ï¸æ³¨æ„ï¼šæˆ‘ä»¬å†™å…¥çš„å†…å®¹å¿…é¡» æ˜¯buffer ï¼ å­—ç¬¦ä¸²</p></li>
<li rel="3"><p>ä¸Šä»£ç </p></li>
</ol>



<pre class="prettyprint hljs-dark"><code class="language-javascript hljs"><div class="hljs-line"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>); 
</div><div class="hljs-line"><span class="hljs-keyword">let</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
</div><div class="hljs-line"><span class="hljs-comment">// å¯å†™æµ æœ‰ä¸¤ä¸ªæ–¹æ³• write() end();</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><span class="hljs-keyword">let</span> ws = fs.createWriteStream(path.resolve(__dirname,<span class="hljs-string">'name1.txt'</span>),{
</div><div class="hljs-line">    <span class="hljs-attr">flags</span>:<span class="hljs-string">'w'</span>, <span class="hljs-comment">// wï¼šæ–‡ä»¶ä¸å­˜åœ¨ä¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ å¦‚æœæœ‰å†…å®¹ä¼šæ¸…ç©ºå†…å®¹</span>
</div><div class="hljs-line">    encoding:<span class="hljs-string">'utf8'</span>,
</div><div class="hljs-line">    <span class="hljs-attr">highWaterMark</span>: <span class="hljs-number">5</span>,<span class="hljs-comment">// æ¯æ¬¡æˆ‘é¢„è®¡å†™å…¥å¤šå°‘ä¸ª  16k</span>
</div><div class="hljs-line">    autoClose:<span class="hljs-literal">true</span>,
</div><div class="hljs-line">    <span class="hljs-attr">start</span>:<span class="hljs-number">0</span>
</div><div class="hljs-line">});
</div><div class="hljs-line"><span class="hljs-keyword">let</span> flag = ws.write(<span class="hljs-number">123</span>+<span class="hljs-string">''</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>{
</div><div class="hljs-line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'å†™å…¥æˆåŠŸ'</span>)
</div><div class="hljs-line">}); <span class="hljs-comment">// å¯è¯»æµ ï¼‹ å¯å†™æµ   æ¯æ¬¡è¯»åä¸ª ï¼ã€‹å»å†™å…¥æ–‡ä»¶ ï¼ã€‹å…ˆåˆ«å»è¯»å–äº†</span>
</div><div class="hljs-line"><span class="hljs-built_in">console</span>.log(flag);
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><span class="hljs-comment">// å½“æˆ‘å†™å…¥å®Œå åœ¨ç»§ç»­å†™å…¥å…¶ä»–çš„ on('drain');</span>
</div><div class="hljs-line"><span class="hljs-comment">// å¤„ç†å¼‚æ­¥ å†…éƒ¨åˆ›å»ºäº†ç©ºé—´  [123,'ç»“æŸ']</span>
</div><div class="hljs-line">ws.end(<span class="hljs-string">'ç»“æŸ'</span>);
</div><div class="hljs-line">ws.write(<span class="hljs-number">123</span>+<span class="hljs-string">''</span>); <span class="hljs-comment">// write after end å·²ç»ç»“æŸäº† ä¸èƒ½åœ¨å†™å…¥äº†</span>
</div></code></pre>



<h4 id="äº”è¯»å†™æµæ··åˆ">äº”ã€è¯»å†™æµæ··åˆ</h4>



<pre class="prettyprint hljs-dark"><code class="language-javascript hljs"><div class="hljs-line"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
</div><div class="hljs-line"><span class="hljs-keyword">let</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
</div><div class="hljs-line"><span class="hljs-comment">// node çš„æµ æ˜¯æœ€å¤æ‚çš„</span>
</div><div class="hljs-line"><span class="hljs-keyword">let</span> r = fs.createReadStream(path.resolve(__dirname,<span class="hljs-string">'name.txt'</span>),{
</div><div class="hljs-line">    <span class="hljs-attr">highWaterMark</span>:<span class="hljs-number">3</span>
</div><div class="hljs-line">});
</div><div class="hljs-line"><span class="hljs-keyword">let</span> w = fs.createWriteStream(path.resolve(__dirname,<span class="hljs-string">'write.txt'</span>),{
</div><div class="hljs-line">    <span class="hljs-attr">highWaterMark</span>:<span class="hljs-number">1</span>,
</div><div class="hljs-line">});
</div><div class="hljs-line">r.pipe(w); <span class="hljs-comment">// æŠŠå¯è¯»æµ å€’å…¥åˆ° å¯å†™æµä¸­</span>
</div><div class="hljs-line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pipe</span>(<span class="hljs-params">r,w</span>)</span>{
</div><div class="hljs-line">    r.on(<span class="hljs-string">'data'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>{
</div><div class="hljs-line">        <span class="hljs-keyword">let</span> flag = w.write(data);
</div><div class="hljs-line">        <span class="hljs-keyword">if</span>(!flag) r.pause();
</div><div class="hljs-line">    });
</div><div class="hljs-line">    <span class="hljs-comment">// ç­‰å¾…å†™å…¥å®Œæˆå æ¢å¤è¯»å–</span>
</div><div class="hljs-line">    r.on(<span class="hljs-string">'end'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
</div><div class="hljs-line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æ–‡ä»¶è¯»å–å®Œæ¯•'</span>);
</div><div class="hljs-line">        w.end();
</div><div class="hljs-line">    });  <span class="hljs-comment">// readFile å¯ä»¥è¯»å– 64kä»¥ä¸‹çš„æ–‡ä»¶ </span>
</div><div class="hljs-line">}; <span class="hljs-comment">//  fileReader</span>
</div><div class="hljs-line"><wbr>
</div></code></pre></div>